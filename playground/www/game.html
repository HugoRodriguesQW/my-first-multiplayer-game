<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <title>Game Multiplayer</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name='viewport' content='user-scalable=0' />

    <style>
      *{
        margin: 0;
        padding: 0;
        background-color: #444;
      }
      body{
        margin-top: -4px;
      }
    </style>

    <script src="/socket.io/socket.io.js"></script>
    <script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>const socket = io();</script>

  </head>
  <body>
      
    <canvas id="game-area"></canvas>
      
    <script>
      
      const canvas = document.getElementById('game-area');
      
      socket.on('bootstrap', (GameFirstState) =>{
        console.log('> Connected. My ID: '+ socket.id)


        canvas.width = innerWidth
        canvas.height = innerHeight
        const ctx = canvas.getContext('2d')
        ctx.fillStyle = "#090117" 
        ctx.fillRect(0,0,canvas.width,canvas.height)
        
        class playerPrefab {
          constructor(x, y, radius, color){ 
            this.x = x
            this.y = y
            this.radius = radius
            this.color = color
          }

          draw(){
          ctx.beginPath()
          ctx.fillStyle = this.color 
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2, false)
          ctx.fill()

          }
        }

        class shootPrefab {
          constructor (x,y,radius,color,speed){
            this.x = x
            this.y = y
            this.radius = radius
            this.color = color
            this.speed = speed

          }

          draw(){
            ctx.beginPath()
            ctx.fillStyle = this.color 
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2, false)
            ctx.fill()

          }

          update() {
            this.draw() 
            this.x = this.x + this.speed.x
            this.y = this.y + this.speed.y
          }
        }

        const player = new playerPrefab((canvas.width / 2),(canvas.height / 2),30,'white')
        player.draw()

        const shoots = []


        function animate() {
          requestAnimationFrame(animate)
          shoots.forEach((shoot) => {
            shoot.update()
          })
        }

        addEventListener('click', (event) => {
          const angle = Math.atan2(
            event.clientY - canvas.height / 2, 
            event.clientX - canvas.width / 2)
          console.log(angle)
          shoots.push(new shootPrefab(canvas.width / 2, canvas.height / 2,5,'white', {x: 1, y: 1}))
        })

        animate()
            
      })

      socket.on('max-connections-error', (message) =>{
        alert(message)
        socket.disconnect()
      })
    </script>
  </body>
</html>