<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="utf-8">
	<title>Jogo Multiplayer</title>

	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<meta name='viewport' content='user-scalable=0' />

	<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@800&display=swap" rel="stylesheet">

	<style>
		* {
			font-family: 'Nunito', sans-serif;
		}

		body {
			cursor: pointer;
			margin: 0;
			margin-top: -4px;
			background: #000;
			user-select: none;
		}
	</style>

	<script src="/socket.io/socket.io.js"></script>
	<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>
	<script>
		const socket = io();
	</script>

</head>

<body>

	<canvas id="game-area"></canvas>


	<script>
		// Import <canvas> and HTML context
    const canvas = document.getElementById('game-area')
    canvas.width = innerWidth
    canvas.height = innerHeight

    const ctx    = canvas.getContext('2d')

     // Game Prefabs
    class ship {
      constructor (position, size, rotation, turnSpeed) {
        this.x = position.x
        this.y = position.y
        this.rotation = rotation
        this.radius = (size / 2)
        this.radian =  (this.rotation / 180 * Math.PI)
        this.turn = turnSpeed
      }
    }

    //Create Game Objects
    const playerShip = new ship({
      x: canvas.width/2, 
      y: canvas.height/2
    }, 30, 90, 360)

    const fps = 60
    const animation = setInterval(update, 1000 / fps)

    function update()
    {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.1)' 
      ctx.fillRect(0,0,canvas.width,canvas.height)

      ctx.beginPath()

      drawShip(playerShip)

      moveShip(playerShip)
    }

    function drawShip (ship){ 

      ctx.lineWidth = ship.size / 20 
      ctx.strokeStyle = 'white'
      ctx.fillStyle = 'white'
      
      ctx.moveTo(
        ship.x + 4 / 3 * (ship.radius * Math.cos(ship.radian)), 
        ship.y - 4 / 3 * (ship.radius * Math.sin(ship.radian))
      )

      ctx.lineTo(
        ship.x - ship.radius * (2 /3 * Math.cos(ship.radian) + Math.sin(ship.radian)), 
        ship.y + ship.radius * (2 /3 * Math.sin(ship.radian) - Math.cos(ship.radian))
      )

      ctx.lineTo(
        ship.x - ship.radius * (2 /3 * Math.cos(ship.radian) - Math.sin(ship.radian)), 
        ship.y + ship.radius * (2 /3 * Math.sin(ship.radian) + Math.cos(ship.radian))
      )

      ctx.closePath()
      ctx.stroke()
      ctx.fill()
      
    }

    // Game Controller
    const controller = {
      increaseSpeed : false,
      decreaseSpeed : false,
      rotateLeft : false,
      rotateRight : false,
      
      listen: function(command){
        let isPressed = command.type === 'keydown'?  true : false
      
        switch(command.keyCode){
          case 87:
            controller.increaseSpeed = isPressed
            break
          case 65:
            console.log('1')
            controller.rotateLeft = isPressed
            break
          case 68:
            console.log('2')
            controller.rotateRight = isPressed
			      break
			    case 83:
			      controller.decreaseSpeed = isPressed
			      break
			  }
			}
    }
    
    document.addEventListener('keydown', controller.listen)
    document.addEventListener('keyup', controller.listen)


    function moveShip (ship){
      if(controller.increaseSpeed){

      }
      if(controller.decreaseSpeed){

      }
      if(controller.rotateLeft){
        ship.rotation =  ship.turn / 180 * Math.PI / (fps * 2)
      }
      if(controller.rotateRight){
        ship.rotation = - ship.turn / 180 * Math.PI / (fps * 2)
      }

      if(!controller.rotateLeft && !controller.rotateRight){
        ship.rotation = 0
      }

      ship.radian = ship.radian + ship.rotation
    }

    update()

    //Diconnect
    socket.on('max-connections-error', (message) =>{
      alert(message)
      ocket.disconnect()
    })
	</script>
</body>

</html>